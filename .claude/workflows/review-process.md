# レビュープロセス

Claude Code による自動レビューのプロセスとガイドラインです。

## レビューフロー

### 1. レビュー開始
タスクが `review/` ディレクトリに移動されたらレビューを開始します。

```
トリガー: in-progress/[instance]/TASK-XXX.md → review/TASK-XXX.md
```

### 2. レビュー実施
レビュアーインスタンスが以下をチェックします。

### 3. レビュー記録
結果を `.claude/reviews/[date]-[task-id].md` に記録します。

### 4. 判定
- **承認**: `review/TASK-XXX.md` → `completed/TASK-XXX.md`
- **要修正**: コメントを付けて `in-progress/[original-instance]/TASK-XXX.md` に戻す

## レビュー観点

### 1. コーディング規約準拠
`docs/rules/coding-standards/` の規約に従っているか確認します。

**チェック項目:**
- [ ] 命名規則が適切
- [ ] インデント・フォーマットが統一
- [ ] コメントが適切（複雑な部分のみ）
- [ ] 不要なコードが残っていない

### 2. セキュリティ
`docs/rules/security.md` のチェックリストを確認します。

**チェック項目:**
- [ ] SQLインジェクション対策
- [ ] XSS対策
- [ ] CSRF対策
- [ ] 認証・認可の実装
- [ ] 機密情報のハードコードなし
- [ ] 入力値の検証

### 3. テスト
`docs/rules/testing-policy.md` の基準を満たしているか確認します。

**チェック項目:**
- [ ] 単体テストが実装されている
- [ ] テストカバレッジが基準を満たす
- [ ] エッジケースがテストされている
- [ ] テストが成功する

### 4. 機能仕様準拠
`docs/specs/features/` の仕様通りに実装されているか確認します。

**チェック項目:**
- [ ] 要件をすべて満たしている
- [ ] 仕様外の機能が追加されていない
- [ ] データフローが仕様通り

### 5. アーキテクチャ整合性
既存のアーキテクチャパターンに従っているか確認します。

**チェック項目:**
- [ ] 既存のディレクトリ構造に従っている
- [ ] 依存関係が適切
- [ ] デザインパターンの一貫性
- [ ] インターフェース定義との整合性

### 6. パフォーマンス
明らかなパフォーマンス問題がないか確認します。

**チェック項目:**
- [ ] N+1問題がない
- [ ] 不要な処理の繰り返しがない
- [ ] メモリリークのリスクがない
- [ ] 適切なデータ構造の使用

### 7. エラーハンドリング
エラーが適切に処理されているか確認します。

**チェック項目:**
- [ ] エラーケースがすべて考慮されている
- [ ] エラーメッセージが明確
- [ ] 適切な例外処理
- [ ] ログ出力が適切

## レビューテンプレート

```markdown
# レビュー記録

**タスクID:** TASK-XXX
**レビュアー:** claude-reviewer-1
**レビュー日時:** YYYY-MM-DD HH:MM
**判定:** [承認 / 要修正]

## サマリー
[実装内容の簡単な説明]

## チェック結果

### ✅ 良い点
- [良かった点1]
- [良かった点2]

### ⚠️ 指摘事項

#### 重大 (修正必須)
- [ ] [指摘1]
- [ ] [指摘2]

#### 軽微 (推奨)
- [ ] [指摘3]
- [ ] [指摘4]

## 詳細コメント

### ファイル: src/example.ts

**Line 42:**
```typescript
// 修正前
const result = data.map(item => item.value)

// 推奨
const result = data.map(item => item.value).filter(Boolean)
```

**理由:** null/undefined の可能性があるため

## 次のアクション
- [修正すべき項目のリスト]
```

## 自動修正の判断基準

以下の場合、レビュアーが自動で修正できます:

### 自動修正OK
- フォーマットの修正
- 明らかなtypo
- コーディング規約の軽微な違反
- import文の整理
- コメントの追加・修正

### 実装者に戻す
- ロジックの変更が必要
- 設計の見直しが必要
- テストの追加が必要
- セキュリティ上の問題
- 仕様との不一致

## レビュー後のフロー

### 承認された場合
1. タスクを `completed/` に移動
2. ダッシュボードを更新
3. 依存タスクがあればブロック解除

### 要修正の場合
1. レビュー記録をタスクファイルに添付
2. タスクを元のインスタンスの `in-progress/` に戻す
3. ダッシュボードを更新
4. 実装者が修正後、再度 `review/` に移動

### 自動修正の場合
1. 修正を実施
2. 修正内容をレビュー記録に記載
3. タスクを `completed/` に移動
4. ダッシュボードを更新

## ベストプラクティス

### 1. 建設的なフィードバック
❌ 悪い例:
```
このコードはダメです。書き直してください。
```

✅ 良い例:
```
このロジックは O(n²) の計算量になっています。
Map を使用することで O(n) に改善できます。

例:
const lookup = new Map(items.map(item => [item.id, item]))
```

### 2. 具体的な修正案
可能な限り具体的なコード例を示します。

### 3. 優先順位の明示
修正の緊急度を明確にします:
- **重大**: セキュリティ、バグ、仕様違反
- **推奨**: パフォーマンス、可読性
- **任意**: スタイル、個人の好み

### 4. ポジティブなフィードバック
良い実装についても積極的にコメントします。

## チェックリスト

レビュー開始前:
- [ ] タスクの仕様を理解した
- [ ] 関連するコーディング規約を確認した
- [ ] セキュリティガイドラインを確認した

レビュー中:
- [ ] すべてのレビュー観点をチェックした
- [ ] 変更されたすべてのファイルを確認した
- [ ] テストを実行した
- [ ] 指摘事項に具体例を付けた

レビュー完了時:
- [ ] レビュー記録を作成した
- [ ] 判定（承認/要修正）を明記した
- [ ] ダッシュボードを更新した
- [ ] タスクを適切なディレクトリに移動した
